<script>
  const clan = [
    { name: "envys", id: "401359" },
    { name: "sinister", id: "2598146" },
    { name: "mauricioae13", id: "9449579" },
    { name: "MrOsoVC8", id: "1485562" }
  ];

  async function loadStats() {
    const tbody = document.getElementById('player-rows');
    tbody.innerHTML = ""; 

    for (let p of clan) {
      // Creamos la fila base
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><span class="player-name">VENÓN | ${p.name}</span></td>
        <td id="elo-${p.id}" class="elo-val">...</td>
        <td><a href="https://www.aoe2insights.com/user/${p.id}/" target="_blank" class="btn-insights">VER MÁS ↗</a></td>
      `;
      tbody.appendChild(row);

      try {
        // Usamos la API de Insights a través del proxy
        const targetUrl = `https://www.aoe2insights.com/api/v4/player/${p.id}/`;
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`);
        
        if (!response.ok) throw new Error();
        
        const data = await response.json();
        const stats = JSON.parse(data.contents);
        
        // Buscamos el ELO de RM 1v1 en la estructura de Insights
        let rating = "N/A";
        
        if (stats && stats.rating) {
           rating = stats.rating;
        } else if (stats && stats.leaderboard && stats.leaderboard.length > 0) {
           // Si no está directo, lo buscamos en su lista de rankings
           const rm1v1 = stats.leaderboard.find(l => l.leaderboard_id === 3);
           if (rm1v1) rating = rm1v1.rating;
        }

        document.getElementById(`elo-${p.id}`).innerText = rating;
      } catch (e) {
        console.error("Error cargando a " + p.name, e);
        document.getElementById(`elo-${p.id}`).innerText = "N/A";
      }
    }
  }

  document.addEventListener('DOMContentLoaded', loadStats);
</script>
